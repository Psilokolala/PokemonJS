// –ö–ª–∞—Å—Å –¥–ª—è —à—É–º–∞ –ü–µ—Ä–ª–∏–Ω–∞
class PerlinNoise {
    constructor() {
        this.permutation = new Array(256);
        for (let i = 0; i < 256; i++) {
            this.permutation[i] = i;
        }
        
        // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –º–∞—Å—Å–∏–≤
        for (let i = 255; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [this.permutation[i], this.permutation[j]] = [this.permutation[j], this.permutation[i]];
        }
        
        // –î—É–±–ª–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
        this.p = [...this.permutation, ...this.permutation];
    }

    fade(t) {
        return t * t * t * (t * (t * 6 - 15) + 10);
    }

    lerp(t, a, b) {
        return a + t * (b - a);
    }

    grad(hash, x, y, z) {
        const h = hash & 15;
        const u = h < 8 ? x : y;
        const v = h < 4 ? y : h === 12 || h === 14 ? x : z;
        return ((h & 1) === 0 ? u : -u) + ((h & 2) === 0 ? v : -v);
    }

    noise(x, y, z = 0) {
        const X = Math.floor(x) & 255;
        const Y = Math.floor(y) & 255;
        const Z = Math.floor(z) & 255;

        x -= Math.floor(x);
        y -= Math.floor(y);
        z -= Math.floor(z);

        const u = this.fade(x);
        const v = this.fade(y);
        const w = this.fade(z);

        const A = this.p[X] + Y;
        const AA = this.p[A] + Z;
        const AB = this.p[A + 1] + Z;
        const B = this.p[X + 1] + Y;
        const BA = this.p[B] + Z;
        const BB = this.p[B + 1] + Z;

        return this.lerp(w,
            this.lerp(v,
                this.lerp(u,
                    this.grad(this.p[AA], x, y, z),
                    this.grad(this.p[BA], x - 1, y, z)
                ),
                this.lerp(u,
                    this.grad(this.p[AB], x, y - 1, z),
                    this.grad(this.p[BB], x - 1, y - 1, z)
                )
            ),
            this.lerp(v,
                this.lerp(u,
                    this.grad(this.p[AA + 1], x, y, z - 1),
                    this.grad(this.p[BA + 1], x - 1, y, z - 1)
                ),
                this.lerp(u,
                    this.grad(this.p[AB + 1], x, y - 1, z - 1),
                    this.grad(this.p[BB + 1], x - 1, y - 1, z - 1)
                )
            )
        );
    }
}

class Game {
    constructor(initialStars = 0) {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã...');
        
        // –°–æ–∑–¥–∞–µ–º canvas –∏ –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ body
        this.canvas = document.createElement('canvas');
        this.canvas.width = 800;
        this.canvas.height = 650; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –Ω–∞ 50 –ø–∏–∫—Å–µ–ª–µ–π –¥–ª—è —Ç–µ–∫—Å—Ç–∞
        document.body.appendChild(this.canvas);
        
        // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ–≥–æ
        this.ctx = this.canvas.getContext('2d');
        if (!this.ctx) {
            console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç canvas');
            return;
        }
        console.log('Canvas —Å–æ–∑–¥–∞–Ω –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—É—á–µ–Ω');

        // –°–æ–∑–¥–∞–µ–º –±—É—Ñ–µ—Ä–Ω—ã–π canvas –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–∏–∫—Å–µ–ª–µ–π
        this.bufferCanvas = document.createElement('canvas');
        this.bufferCanvas.width = 800;
        this.bufferCanvas.height = 600; // –û—Å—Ç–∞–≤–ª—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É –¥–ª—è –∫–∞—Ä—Ç—ã
        this.bufferCtx = this.bufferCanvas.getContext('2d');

        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è canvas
        this.canvas.style.border = '1px solid black';
        this.canvas.style.display = 'block';
        this.canvas.style.margin = '0 auto';

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç—É
        this.mapImage = new Image();
        this.mapImage.crossOrigin = 'anonymous'; // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É cross-origin
        this.mapImage.src = 'assets/map.png';
        this.mapLoaded = false;
        this.mapImage.onload = () => {
            console.log('–ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            this.mapLoaded = true;
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas –ø–æ–¥ —Ä–∞–∑–º–µ—Ä –∫–∞—Ä—Ç—ã
            this.canvas.width = this.mapImage.width;
            this.canvas.height = this.mapImage.height;
            this.bufferCanvas.width = this.mapImage.width;
            this.bufferCanvas.height = this.mapImage.height;
            
            // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∫–∞—Ä—Ç—É –≤ –±—É—Ñ–µ—Ä–Ω—ã–π canvas
            this.bufferCtx.drawImage(this.mapImage, 0, 0);
            
            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –±–∏–æ–º—ã –ø–æ–¥ –Ω–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä
            this.biomes = [];
            this.generateSimpleBiomes();

            // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–∫–µ–º–æ–Ω–æ–≤ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö
            this.clearAllPokemons();
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã—Ö –ø–æ–∫–µ–º–æ–Ω–æ–≤ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã
            this.createPokemon();
        };
        this.mapImage.onerror = () => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã');
        };

        this.pokemons = [];
        this.moonStones = [];
        this.loadingCount = 0;
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥—Ä–∞–∫–∏ –ø–æ–∫–µ–º–æ–Ω–æ–≤
        this.fightingPokemons = [];
        this.sparkParticles = [];
        this.lastFightTime = 0; // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –¥—Ä–∞–∫–∏
        
        // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–∫–µ–º–æ–Ω–æ–≤
        this.clearAllPokemons = () => {
            this.pokemons = [];
            this.loadingCount = 0;
        };
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–∫–∏ –ø–æ–∫–µ–º–æ–Ω–æ–≤ –ø–æ —Ç–∏–ø–∞–º
        this.flyingTypes = [
            'Charizard üî•',
            'Dragonite üêâ',
            'Rayquaza üêâ',
            'Salamence üî•'
        ];

        this.waterTypes = [
            'Squirtle üíß',
            'Gyarados üåä',
            'Blastoise üí¶',
            'Greninja üê∏'
        ];

        this.landTypes = [
            'Pikachu ‚ö°Ô∏è',
            'Bulbasaur üåø',
            'Eevee ‚ú®',
            'Mewtwo üß†',
            'Lucario ü•ã',
            'Gengar üëª',
            'Snorlax üò¥',
            'Arcanine üî•',
            'Jigglypuff üé§',
            'Machamp üí™',
            'Venusaur üçÉ',
            'Alakazam üîÆ',
            'Gardevoir üíñ',
            'Tyranitar üèî',
            'Zoroark ü¶ä',
            'Sylveon üéÄ',
            'Infernape üî•üêµ',
            'Metagross üõ°',
            'Darkrai üåë',
            'Cyndaquil üî•',
            'Chandelure üïØ',
            'Umbreon üåô'
        ];

        // –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —Ç–∏–ø—ã –≤ –æ–¥–∏–Ω —Å–ø–∏—Å–æ–∫
        this.allPokemon = [...this.flyingTypes, ...this.waterTypes, ...this.landTypes];

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –º–µ—Å—Ç–Ω–æ—Å—Ç–∏
        this.terrainTypes = {
            WATER: 'water',
            LAND: 'land',
            OUT_OF_BOUNDS: 'out'
        };

        // –î–æ–±–∞–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
        this.animationFrame = 0;

        // –î–æ–±–∞–≤–ª—è–µ–º —à—É–º –ü–µ—Ä–ª–∏–Ω–∞
        this.noise = new PerlinNoise();

        // –°–æ–∑–¥–∞–µ–º –±–∏–æ–º—ã (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –∫–∞—Ä—Ç—ã)
        this.biomes = [];
        this.biomeSize = 32;
        this.generateSimpleBiomes();
        console.log('–ë–∏–æ–º—ã —Å–æ–∑–¥–∞–Ω—ã:', this.biomes.length);

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏
        const loadingElement = document.getElementById('loading');
        if (loadingElement) {
            loadingElement.style.display = 'block';
            console.log('–≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω');
        }

        // –°–æ–∑–¥–∞–µ–º –ª—É–Ω–Ω—ã–µ –∫–∞–º–Ω–∏
        console.log('–°–æ–∑–¥–∞–Ω–∏–µ –ª—É–Ω–Ω—ã—Ö –∫–∞–º–Ω–µ–π...');
        for (let i = 0; i < 5; i++) {
            this.moonStones.push({
                x: Math.random() * this.canvas.width,
                y: Math.random() * this.canvas.height,
                collected: false
            });
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
        this.currentMessage = null;
        this.messageTimer = null;
        this.messageDisplayTime = 2000; // 2 —Å–µ–∫—É–Ω–¥—ã
        this.messageInterval = Math.floor(Math.random() * 3000) + 7000; // –°–ª—É—á–∞–π–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç 7 –¥–æ 10 —Å–µ–∫—É–Ω–¥
        this.lastMessagePokemon = null;
        this.lastMessageTime = 0;

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏—Å—Ç–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏–π
        this.startMessageSystem();

        // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Å—Å–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–∫–µ–º–æ–Ω–æ–≤ –ø—Ä–∏ –∫–ª–∏–∫–µ
        this.pokemonClickMessages = [
            "–û–π, —â–µ–∫–æ—Ç–Ω–æ!",
            "–¢—ã –æ–ø—è—Ç—å? –Ø –Ω–µ —É—Å—Ç–∞–ª!",
            "–ï—Å—Ç—å —á—Ç–æ-–Ω–∏–±—É–¥—å –≤–∫—É—Å–Ω–µ–Ω—å–∫–æ–µ?",
            "–¢—ã —á—Ç–æ, –º–µ–Ω—è —Ä–∞–∑–±—É–¥–∏–ª?",
            "–Ø –∫—Ä–∞—Å–∏–≤—ã–π, –¥–∞?",
            "–•–≤–∞—Ç–∏—Ç –º–µ–Ω—è –¥–µ—Ä–≥–∞—Ç—å!",
            "–î–∞–π —Ö–≤–æ—Å—Ç–∏–∫ –ø–æ—á–µ—Å–∞—Ç—å!",
            "–¢—ã –º–Ω–µ –Ω—Ä–∞–≤–∏—à—å—Å—è!",
            "–Ø —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø–æ–æ–±–µ–¥–∞–ª, –Ω–µ —Ç—Ä–æ–≥–∞–π –º–µ–Ω—è!",
            "–ù–µ —Ç—Ä–æ–≥–∞–π –º–µ–Ω—è, —è —Ç—É—Ç —Ä–∞–∑–º—ã—à–ª—è—é!",
            "–¢—ã –∑–Ω–∞–µ—à—å, —á—Ç–æ —è —Å–∞–º—ã–π –ª—É—á—à–∏–π?",
            "–ù—É –¥–∞–≤–∞–π, —É–¥–∏–≤–∏ –º–µ–Ω—è!",
            "–ù–µ —à—É—Ç–∫–∏, –∞ —Ä–µ–∞–ª—å–Ω–æ —Å–º–µ—à–Ω–æ!",
            "–£ –º–µ–Ω—è —Ç—É—Ç –≤—Å—Ç—Ä–µ—á–∞, –ø–æ–¥–æ–∂–¥–∏ –Ω–µ–º–Ω–æ–≥–æ.",
            "–¢—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –ø—Ä–æ–±–æ–≤–∞–ª –∑–µ–ª—å–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è?",
            "–ó–Ω–∞–µ—à—å, —è –º–æ–≥—É —Å—Ç–∞—Ç—å –Ω–µ–≤–∏–¥–∏–º—ã–º‚Ä¶ –ø–æ—á—Ç–∏!",
            "–Ø –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫—Ä–∞—Å–∏–≤—ã–π, —è –µ—â—ë –∏ —É–º–Ω—ã–π!",
            "–•–æ—á—É —Å–ø–∞—Ç—å‚Ä¶ –Ω–æ –ª–∞–¥–Ω–æ, –¥–∞–≤–∞–π!",
            "–ù–∞–∂–º–∏ –µ—â—ë —Ä–∞–∑, –º–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è!",
            "–Ø —Ç—É—Ç –∫–∞–∫-—Ç–æ –ø—Ä–æ—Å—Ç–æ –æ—Ç–¥—ã—Ö–∞—é.",
            "–ù–∏—á–µ–≥–æ –Ω–µ –∂–¥—É‚Ä¶ –∏–ª–∏ –≤—Å—ë-—Ç–∞–∫–∏ –∂–¥—É?",
            "–ú–æ–∂–Ω–æ –Ω–µ –¥–µ—Ä–≥–∞—Ç—å –º–µ–Ω—è –∫–∞–∂–¥—ã–π —Ä–∞–∑?",
            "–õ–∞–¥–Ω–æ-–ª–∞–¥–Ω–æ, —á—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ?",
            "–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –º–æ–∂–Ω–æ –º–µ–Ω—è —â–µ–∫–æ—Ç–∞—Ç—å?",
            "–î–∞–π –º–Ω–µ –ø–∞—Ä—É –º–∏–Ω—É—Ç, –º–Ω–µ –Ω—É–∂–Ω–æ –ø–æ–¥—É–º–∞—Ç—å.",
            "–Ø –≤–æ–æ–±—â–µ-—Ç–æ –∑–∞–Ω—è—Ç, –Ω–æ –¥–∞–≤–∞–π –ø–æ–≥–æ–≤–æ—Ä–∏–º!",
            "–ù–µ —Å—Ç–æ–∏—Ç –º–µ–Ω—è –±—É–¥–∏—Ç—å, —è –ª—é–±–ª—é —Å–ø–∞—Ç—å.",
            "–¢—ã –º–µ–Ω—è –Ω–µ —É—Ç–æ–º–∏–ª –µ—â—ë?",
            "–ß—Ç–æ, –æ–ø—è—Ç—å —è? –ù—É –ª–∞–¥–Ω–æ.",
            "–Ø –ø—Ä–æ—Å—Ç–æ –Ω–∞—Å–ª–∞–∂–¥–∞—é—Å—å –∂–∏–∑–Ω—å—é, –ø–æ–Ω—è–ª?",
            "–ù–µ –∑–ª–∏ –º–µ–Ω—è, —è –º–æ–≥—É –±—ã—Ç—å —Å–º–µ—à–Ω—ã–º!",
            "–¢—ã –¥—É–º–∞–µ—à—å, —è –Ω–µ –º–æ–≥—É –±–µ–≥–∞—Ç—å –±—ã—Å—Ç—Ä–æ?",
            "–•–æ—á–µ—à—å, —è —Ä–∞—Å—Å–∫–∞–∂—É —à—É—Ç–∫—É?",
            "–¢—ã –ø—Ä–∞–≤–¥–∞ –≤–µ—Ä–∏—à—å, —á—Ç–æ —è –º–æ–≥—É –ø—Ä—ã–≥–Ω—É—Ç—å?",
            "–£ —Ç–µ–±—è –µ—Å—Ç—å —Å–µ–∫—Ä–µ—Ç—ã? –Ø –ª—é–±–ª—é —Å–µ–∫—Ä–µ—Ç—ã!",
            "–ú–æ–∂–µ—Ç, –ø—Ä–æ—Å—Ç–æ –ø–æ—Å–∏–¥–∏–º –∏ –ø–æ–º–æ–ª—á–∏–º?",
            "–°–ª—É—à–∞–π, —è —Ç–∞–∫ —É—Å—Ç–∞–ª‚Ä¶ –∏–ª–∏ –Ω–µ—Ç?",
            "–ù–µ –∂–º–∏ –º–µ–Ω—è —Ç–∞–∫ —á–∞—Å—Ç–æ, —è –∂–µ –Ω–µ –∫–Ω–æ–ø–∫–∞!",
            "–ú–æ–≥—É —Å—Ç–∞—Ç—å —Ç–≤–æ–∏–º –ª—É—á—à–∏–º –¥—Ä—É–≥–æ–º, –Ω–æ —Ç—ã –¥–æ–ª–∂–µ–Ω –∑–∞—Å–ª—É–∂–∏—Ç—å —ç—Ç–æ!",
            "–¢—ã –Ω–µ –ø—Ä–æ—Ç–∏–≤, –µ—Å–ª–∏ —è –Ω–µ–º–Ω–æ–≥–æ –ø–æ–±—É–¥—É –ª–µ–Ω–∏–≤—ã–º?",
            "–û, –ø—Ä–∏–≤–µ—Ç, —Ç—ã –≤—Å—ë –µ—â—ë –∑–¥–µ—Å—å?",
            "–¢—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –¥—É–º–∞–ª, —á—Ç–æ —è –º–æ–≥—É —Ç–∞–Ω—Ü–µ–≤–∞—Ç—å?",
            "–Ø —É–º–µ—é —á–∏—Ç–∞—Ç—å –º—ã—Å–ª–∏! –ù–æ —Ç–æ–ª—å–∫–æ –∏–Ω–æ–≥–¥–∞.",
            "–ú–Ω–µ —Ç–∞–∫ –Ω—Ä–∞–≤–∏—Ç—Å—è, –∫–æ–≥–¥–∞ —Ç—ã –º–µ–Ω—è —Ç—Ä–æ–≥–∞–µ—à—å!",
            "–ù—É –∫–∞–∫ —Ç–µ–±–µ? –Ø –ø–æ—Ç—Ä—è—Å–∞—é—â–∏–π?",
            "–¢—ã –∂–µ –Ω–µ –±—É–¥–µ—à—å –º–µ–Ω—è —Å–µ–π—á–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç—å, –¥–∞?",
            "–ß—Ç–æ –±—É–¥–µ–º –¥–µ–ª–∞—Ç—å? –°–ø–∞—Ç—å –∏–ª–∏ –≤–µ—Å–µ–ª–∏—Ç—å—Å—è?",
            "–¢—ã —Ç–∞–∫ —á–∞—Å—Ç–æ –º–µ–Ω—è –Ω–∞–∂–∏–º–∞–µ—à—å, —á—Ç–æ —è —É–∂–µ –ø—Ä–∏–≤—ã–∫!",
            "–Ø –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–µ–º–æ–Ω, —è ‚Äî —Å–µ–Ω—Å–∞—Ü–∏—è!",
            "–ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —Ç—ã –º–µ–Ω—è –æ–±–æ–∂–∞–µ—à—å!",
            "–£ –º–µ–Ω—è –µ—Å—Ç—å –∏–¥–µ—è, –Ω–æ –æ–Ω–∞ —Å—Ç—Ä–∞–Ω–Ω–∞—è!",
            "–¢—ã –≤–æ–æ–±—â–µ –ø–æ–Ω–∏–º–∞–µ—à—å, —á—Ç–æ —è ‚Äî –∑–≤–µ–∑–¥–∞?",
            "–Ø –∂–µ –Ω–µ –∏–≥—Ä—É—à–∫–∞! –•–æ—Ç—è‚Ä¶ –ø–æ—á—Ç–∏!",
            "–¢—ã –Ω–∞ –º–µ–Ω—è –Ω–µ –æ–±–∏–∂–µ–Ω, –ø—Ä–∞–≤–¥–∞?",
            "–ö–∞–∫ —Ç–µ–±–µ –º–æ–∏ —É—à–∫–∏? –ö–ª–∞—Å—Å–Ω—ã–µ?",
            "–õ–∞–¥–Ω–æ, —è —Ç–µ–±–µ –ø—Ä–æ—â–∞—é—Å—å. –ü–æ–π–¥—É —Å–ø–∞—Ç—å!",
            "–Ø –≤ –æ—Ç–ø—É—Å–∫–µ, –Ω–æ –º–æ–∂–Ω–æ –µ—â—ë –Ω–µ–º–Ω–æ–≥–æ –ø–æ–∏–≥—Ä–∞—Ç—å!"
        ];

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–Ω–æ–ø–∫–∞–º
        this.canvas.addEventListener('click', (event) => {
            const rect = this.canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–∞–º
            if (this.isClickOnNFTButton(x, y)) {
                window.open('https://getgems.io/collection/EQDtXpkmwbKk8HoRSEcmwo1EY5dyDns1MgucjHOgCn-ydfVX', '_blank');
                return;
            }
            if (this.isClickOnTelegramButton(x, y)) {
                window.open('https://t.me/aipokemons', '_blank');
                return;
            }

            // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–æ–≤ –ø–æ –ø–æ–∫–µ–º–æ–Ω–∞–º
            this.pokemons.forEach(pokemon => {
                const dx = x - pokemon.x;
                const dy = y - pokemon.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                if (distance < pokemon.size / 2) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–±—Ä–∞—Ü–∏—é –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø–æ–∫–µ–º–æ–Ω–∞
                    if (navigator.vibrate) {
                        navigator.vibrate(50); // 50–º—Å –≤–∏–±—Ä–∞—Ü–∏–∏
                    }

                    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∫–ª–∏–∫–∞
                    const randomMessage = this.pokemonClickMessages[
                        Math.floor(Math.random() * this.pokemonClickMessages.length)
                    ];

                    // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
                    if (this.messageTimer) {
                        clearTimeout(this.messageTimer);
                    }

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    this.currentMessage = {
                        pokemon: pokemon,
                        text: randomMessage,
                        timeLeft: this.messageDisplayTime
                    };

                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
                    this.messageTimer = setTimeout(() => {
                        this.currentMessage = null;
                    }, this.messageDisplayTime);
                }
            });
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–µ—Ä–µ–≤—å–µ–≤ –∏ –∏—Ö —Ä–∞–∑–º–µ—Ä—ã
        this.trees = [
            { x: 140, y: 120, radius: 25, height: 90 },  // –õ–µ–≤–∞—è –ø–∞–ª—å–º–∞
            { x: 290, y: 120, radius: 25, height: 90 },  // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–∞–ª—å–º–∞
            { x: 460, y: 100, radius: 25, height: 90 }   // –ü—Ä–∞–≤–∞—è –ø–∞–ª—å–º–∞
        ];

        // –î–æ–±–∞–≤–ª—è–µ–º —Ü–≤–µ—Ç–∞ –¥–ª—è –∏—Å–∫—Ä
        this.sparkColors = [
            'rgba(255, 255, 0', // –∂–µ–ª—Ç—ã–π
            'rgba(255, 0, 0',   // –∫—Ä–∞—Å–Ω—ã–π
            'rgba(0, 255, 255', // –≥–æ–ª—É–±–æ–π
            'rgba(255, 0, 255', // —Ä–æ–∑–æ–≤—ã–π
            'rgba(0, 255, 0'    // –∑–µ–ª–µ–Ω—ã–π
        ];

        // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Å—Å–∏–≤ –±–æ–µ–≤—ã—Ö —Ñ—Ä–∞–∑
        this.pokemonBattleQuotes = [
            "–°–µ–π—á–∞—Å –ø–∞–ª–µ—Ü –æ—Ç–∫—É—à—É!",
            "–¢—ã —Å–∞–º –Ω–∞–ø—Ä–æ—Å–∏–ª—Å—è!",
            "–õ–æ–≤–∏ –ø–ª—é—Ö—É!",
            "–û–π, —ç—Ç–æ —è —Å–ª—É—á–∞–π–Ω–æ...",
            "–ù—É –≤—Å—ë, –¥–µ—Ä–∂–∏—Å—å!",
            "–ì–¥–µ –∫–Ω–æ–ø–∫–∞ ¬´—Å–¥–∞—Ç—å—Å—è¬ª?",
            "–¢—ã —á—Ç–æ, –±–µ—Å—Å–º–µ—Ä—Ç–Ω—ã–π?",
            "–ë–µ–π —Å–∏–ª—å–Ω–µ–µ, –Ω–µ —á—É–≤—Å—Ç–≤—É—é!",
            "–Ø —Ç—É—Ç —á–∏—Å—Ç–æ —Ä–∞–¥–∏ –æ–ø—ã—Ç–∞!",
            "–î–∞–≤–∞–π –±—ã—Å—Ç—Ä–µ–µ, —É –º–µ–Ω—è –æ–±–µ–¥!",
            "–ù–µ –∑–ª–∏ –º–µ–Ω—è!",
            "–¢—ã –¥–≤–∏–≥–∞–µ—à—å—Å—è –∏–ª–∏ —É –º–µ–Ω—è –ª–∞–≥–∏?",
            "–≠–π, —Å—É–¥—å—è, –æ–Ω —á–∏—Ç–µ—Ä!",
            "–Ø –µ—â—ë –Ω–µ –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º–µ!",
            "–ú–æ–∂–Ω–æ —è —É–¥–∞—Ä—é –º–æ—Ä–∞–ª—å–Ω–æ?",
            "–û–π, —Å–∞–º —Å–µ–±—è —É–¥–∞—Ä–∏–ª...",
            "–ö–∞–∂–µ—Ç—Å—è, —è —ç—Ç–æ –≤–∏–¥–µ–ª –≤ –∞–Ω–∏–º–µ!",
            "–í–æ—Ç –±—ã —Ö–∏–ª–∫—É —Å–µ–π—á–∞—Å...",
            "–¢—ã —Å–µ—Ä—å—ë–∑–Ω–æ? –≠—Ç–æ –±—ã–ª —É–¥–∞—Ä?",
            "–ù–µ –º–æ–≥—É –ø—Ä–æ–∏–≥—Ä–∞—Ç—å, —É –º–µ–Ω—è —Å–≤–∏–¥–∞–Ω–∫–∞!",
            "–ë–æ–π –±–æ–π, –∞ —á–∞–π –ø–∏—Ç—å –±—É–¥–µ–º?",
            "–•–æ—á–µ—à—å, —è –ø–æ–¥–¥–∞–º—Å—è? –®—É—Ç–∫–∞!",
            "–í–æ—É, –º–Ω–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å, –¥–∞–≤–∞–π –µ—â—ë!",
            "–ö–∞–∫–æ–π —É—Ä–æ–Ω?! –£ –º–µ–Ω—è —à–∫—É—Ä–∞ –¥—É–±–æ–≤–∞—è!",
            "–Ø –≤—ã–∑—ã–≤–∞—é —Ä–µ—Ñ–µ—Ä–∏!",
            "–ê–π, —ç—Ç–æ –±—ã–ª–æ –±–æ–ª—å–Ω–æ...",
            "–¢—ã —Å–∏–ª—ë–Ω, –Ω–æ —è –ª–µ–Ω–∏–≤!",
            "–ú–Ω–µ –±—ã –ª–µ–≤–µ–ª–∞–ø...",
            "–≠—Ç–æ —è —Ç–µ–±—è –∏–ª–∏ —Ç—ã –º–µ–Ω—è —É–¥–∞—Ä–∏–ª?",
            "–ê –º–æ–∂–Ω–æ –±–µ–∑ –æ—Ç–≤–µ—Ç–∫–∏?",
            "–ù—É –≤—Å—ë, –≤–∫–ª—é—á–∞—é —Å–µ—Ä—å—ë–∑–Ω—ã–π —Ä–µ–∂–∏–º!",
            "–ê –º–æ–∂–µ—Ç, –Ω–µ –±—É–¥–µ–º –¥—Ä–∞—Ç—å—Å—è?",
            "–°–¥–∞–≤–∞–π—Å—è, –ø–æ–∫–∞ –Ω–µ –ø–æ–∑–¥–Ω–æ!",
            "–Ø –≤ –ø–æ—Ä—è–¥–∫–µ, –ø—Ä–æ—Å—Ç–æ –ª–µ–∂—É...",
            "–¢—ã —á—Ç–æ, –±–æ—Å—Å?",
            "–ê –∫–∞–∫ –æ—Ç–º–µ–Ω–∏—Ç—å —Ö–æ–¥?",
            "–¢–≤–æ—è –∞—Ç–∞–∫–∞ ‚Äî —ç—Ç–æ –≤—Å—ë?",
            "–Ø –¥–∞–∂–µ –Ω–µ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª!",
            "–û–π, —á—Ç–æ-—Ç–æ —Ö–ø –±—ã—Å—Ç—Ä–æ –ø–∞–¥–∞–µ—Ç...",
            "–¢—ã —á—Ç–æ, —Ö–∏–ª—å–Ω—É–ª—Å—è?!",
            "–Ø —É–∂–µ –∂–∞–ª–µ—é, —á—Ç–æ –Ω–∞—á–∞–ª...",
            "–£–¥–∞—Ä –±—ã–ª –Ω–µ–ø–ª–æ—Ö, –Ω–æ —è –ª—É—á—à–µ!",
            "–Ø –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑–æ–≥—Ä–µ–≤–∞—é—Å—å!",
            "–¢—ã –≥–æ—Ç–æ–≤ –∫ –∫–æ–º–±–æ-—É–¥–∞—Ä—É?",
            "–•–≤–∞—Ç–∏—Ç, —É –º–µ–Ω—è –ª–∞–ø–∫–∏!",
            "–ö–∞–∫ –Ω–∞—Å—á—ë—Ç –Ω–∏—á—å–µ–π?",
            "–ú–æ–∂–µ—Ç, –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–∏–º–µ–º—Å—è?",
            "–û–≥–æ, —Ç—ã —Ä–µ–∞–ª—å–Ω–æ —Å–∏–ª—ë–Ω!",
            "–Ø –≤—Å—ë –µ—â—ë —Å—Ç–æ—é? –ù–µ–ø–ª–æ—Ö–æ!",
            "–ù—É –≤—Å—ë, –¥–µ—Ä–∂–∏—Å—å, —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —É–¥–∞—Ä!",
            "–¢—ã —Ç–æ—á–Ω–æ —É–≤–µ—Ä–µ–Ω, —á—Ç–æ —Ö–æ—á–µ—à—å –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å?",
            "–ù—É —Ç—ã –ø—Ä—è–º –∫–∞–∫ —É—Ä–∞–≥–∞–Ω!",
            "–¢—ã –∫–∞–∫ –º–Ω–µ —Å —ç—Ç–∏–º —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è?",
            "–¢—ã –∂–µ –Ω–µ –¥—É–º–∞–ª, —á—Ç–æ —è —Å–¥–∞–º—Å—è?",
            "–•–≤–∞—Ç–∏—Ç —É–∂–µ, —è —É—Å—Ç–∞–ª –æ—Ç —Ç–≤–æ–∏—Ö –∞—Ç–∞–∫!",
            "–ù—É, —á—Ç–æ, —Å–Ω–æ–≤–∞ —Å—ã–≥—Ä–∞–µ–º –≤ –∫–∞–º–µ–Ω—å-–Ω–æ–∂–Ω–∏—Ü—ã-–±—É–º–∞–≥–∞?",
            "–í–æ—Ç —Ç–∞–∫, –∞ —Ç–µ–ø–µ—Ä—å –º–æ–π —Ö–æ–¥!",
            "–Ø —á—Ç–æ-—Ç–æ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª, –∫–∞–∫ —É–¥–∞—Ä–∏–ª!",
            "–Ø —Ç–µ–±–µ –ø–æ—Ç–æ–º –≤—Å—ë –æ–±—ä—è—Å–Ω—é, –Ω–æ –ø–æ—Å–ª–µ –ø–æ–±–µ–¥—ã!",
            "–ö–∞–∂–µ—Ç—Å—è, –º–Ω–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∏—Ç—å—Å—è...",
            "–°–µ–π—á–∞—Å —è –≤—ã–≤–µ–¥—É –Ω–æ–≤—É—é —Ç–∞–∫—Ç–∏–∫—É!",
            "–¢—ã –º–µ–Ω—è –∑–∞–ø–∞—Ä–∏–ª, –Ω–æ –Ω–∏—á–µ–≥–æ, —è –≤—Å—ë —Ä–∞–≤–Ω–æ –≤—ã–∏–≥—Ä–∞—é!",
            "–¢—ã –Ω–µ –∑–Ω–∞–µ—à—å, —Å –∫–µ–º —Å–≤—è–∑–∞–ª—Å—è!",
            "–Ø –±—É–¥—É —Å—Ä–∞–∂–∞—Ç—å—Å—è –¥–æ –∫–æ–Ω—Ü–∞, –Ω–æ —Ç—ã –º–µ–Ω—è –Ω–µ –ø–æ–±–µ–¥–∏—à—å!",
            "–ù–µ —Å–¥–∞–≤–∞–π—Å—è, —è –≤—Å—ë —Ä–∞–≤–Ω–æ —Ç–µ–±—è –æ–¥–æ–ª–µ—é!",
            "–ù–µ –Ω–µ—Ä–≤–Ω–∏—á–∞–π, —è –∂–µ –Ω–µ –ø–æ–±–µ–¥–∏–ª –µ—â—ë!",
            "–ê —á—Ç–æ, —Ç–∞–∫ –º–æ–∂–Ω–æ –±—ã–ª–æ?",
            "–Ø —Ç–µ–±—è –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏–ª, –Ω–æ —Ç—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–∞–∂–∞–ª!",
            "–ê –º–æ–∂–µ—Ç, –≤–æ–∑—å–º—ë–º –ø–∞—É–∑—É –∏ –≤—ã–ø—å—ë–º –≤–æ–¥—ã?",
            "–¢—ã –º–µ–Ω—è –æ–±–∏–∂–∞–µ—à—å, –Ω–æ —è –≤—Å—ë —Ä–∞–≤–Ω–æ –≤—ã–∏–≥—Ä–∞—é!",
            "–ú–æ–∂–µ—Ç, –ø—Ä–æ—Å—Ç–æ —Å–¥–∞–¥–∏–º—Å—è –∏ —Å—Ç–∞–Ω–µ–º –¥—Ä—É–∑—å—è–º–∏?",
            "–¢—ã —É–≤–µ—Ä–µ–Ω, —á—Ç–æ —Ö–æ—á–µ—à—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å? –Ø —Å–µ—Ä—å—ë–∑–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!",
            "–°–µ–π—á–∞—Å –ø–æ–∫–∞–∂—É —Ç–µ–±–µ —Å–≤–æ–∏ —Å—É–ø–µ—Ä—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏!",
            "–¢–∞–∫, –≤—Ä–µ–º—è –¥–ª—è —Ä–µ—à–∞—é—â–µ–≥–æ —É–¥–∞—Ä–∞!",
            "–¢—ã —Ä–µ–∞–ª—å–Ω–æ –¥—É–º–∞–µ—à—å, —á—Ç–æ —ç—Ç–æ –º–µ–Ω—è –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç?",
            "–Ø —Å—Ç–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–±–µ–∂–¥–∞–ª, —á—Ç–æ —É–∂–µ —Å–∫—É—á–Ω–æ!",
            "–ö–∞–∂–µ—Ç—Å—è, —Ç—ã –Ω–µ –¥–æ –∫–æ–Ω—Ü–∞ –ø–æ–Ω—è–ª, –∫—Ç–æ —Ç—É—Ç –≥–ª–∞–≤–Ω—ã–π!",
            "–Ø, –∫–æ–Ω–µ—á–Ω–æ, –Ω–µ —Å—É–ø–µ—Ä–≥–µ—Ä–æ–π, –Ω–æ –ø–æ–±–µ–∂–¥–∞—Ç—å —É–º–µ—é!"
        ];

        // –î–æ–±–∞–≤–ª—è–µ–º —Ü–∏—Ç–∞—Ç—ã –ø—Ä–æ Telegram Premium
        this.telegramQuotes = [
            "–î—É—Ä–æ–≤, –ø–æ–¥–∞—Ä–∏ –ø—Ä–µ–º–∏—É–º!",
            "–ò–ò —Å–∫–∞–∑–∞–ª, –º–Ω–µ –Ω—É–∂–µ–Ω –ø—Ä–µ–º–∏—É–º!",
            "–ñ–¥—É –ø–æ–¥–∞—Ä–æ–∫ –æ—Ç Telegram!",
            "–ü—Ä–µ–º–∏—É–º ‚Äî –±–∏–ª–µ—Ç –≤ —ç–ª–∏—Ç—É!",
            "–ì–¥–µ –º–æ–∏ –∑–≤—ë–∑–¥—ã, –î—É—Ä–æ–≤?",
            "–ò–ò –æ–±–µ—â–∞–ª –º–Ω–µ –ø–æ–¥–ø–∏—Å–∫—É!",
            "–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è? –ù–µ, –Ω–µ —Å–ª—ã—à–∞–ª!",
            "–Ø –Ω–µ –ø—Ä–µ–º–∏—É–º, –Ω–æ –º—ã—Å–ª–µ–Ω–Ω–æ —Ç–∞–º!",
            "–ö–∞–∂–µ—Ç—Å—è, —è —Ä–æ–¥–∏–ª—Å—è –±–µ–∑ –∑–≤—ë–∑–¥!",
            "–ü—Ä–µ–º–∏—É–º ‚Äî –º–æ–π —Å–º—ã—Å–ª –∂–∏–∑–Ω–∏!",
            "–î—É—Ä–æ–≤, –¥–∞–π —Å–∏–ª‚Ä¶ –∏ –ø–æ–¥–ø–∏—Å–∫—É!",
            "–ë–µ–∑ –ø—Ä–µ–º–∏—É–º–∞ –¥–∞–∂–µ —Å—Ç–∏–∫–µ—Ä—ã –≥—Ä—É—Å—Ç–Ω—ã–µ!",
            "–ò–ò —Å–∫–∞–∑–∞–ª, —á—Ç–æ —è –Ω–µ VIP‚Ä¶",
            "–ü–æ–π–¥—É –∫–æ–ø–∏—Ç—å –Ω–∞ Telegram Premium!",
            "–ú–æ–∂–µ—Ç, –º–Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–∞—Ä—è—Ç –∑–≤–µ–∑–¥—É?",
            "–ó–∞–≤—Ç—Ä–∞ –∫—É–ø–ª—é –ø—Ä–µ–º–∏—É–º‚Ä¶ –º–æ–∂–µ—Ç –±—ã—Ç—å!",
            "–ò–ò –¥—É–º–∞–µ—Ç, —á—Ç–æ —è –±–æ–≥–∞—Ç‚Ä¶ –Ω–∞ —ç–º–æ—Ü–∏–∏!",
            "–ú–æ–∂–µ—Ç, –ø—Ä–µ–º–∏—É–º –¥–æ–±–∞–≤–∏—Ç –º–Ω–µ —É–º–∞?",
            "–î—É—Ä–æ–≤, —É—Å—ã–Ω–æ–≤–∏ –º–µ–Ω—è!",
            "–ö—É–ø–ª—é Telegram Premium, –∫–æ–≥–¥–∞ —Ä–∞–∑–±–æ–≥–∞—Ç–µ—é!",
            "–ü—Ä–µ–º–∏—É–º ‚Äî —ç—Ç–æ –∫–∞–∫ –ª—é–±–æ–≤—å, –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–µ –≤—Å–µ–º!",
            "–ü—Ä–µ–º–∏—É–º ‚Äî –º–æ–π –ø—Ä–æ–ø—É—Å–∫ –≤ –≤—ã—Å—à–∏–π —Å–≤–µ—Ç!",
            "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–æ–≤–µ—Ä—è—é: –≤–¥—Ä—É–≥ –î—É—Ä–æ–≤ —Å–¥–µ–ª–∞–ª –º–µ–Ω—è —ç–ª–∏—Ç–æ–π!",
            "–ï—Å–ª–∏ –Ω–µ –∫—É–ø–ª—é –ø—Ä–µ–º–∏—É–º, —É–π–¥—É –≤ ICQ!",
            "–ò–ò —Å–∫–∞–∑–∞–ª, —á—Ç–æ —è –æ–±—ã—á–Ω—ã–π‚Ä¶ –ü—Ä–µ–º–∏—É–º –∏—Å–ø—Ä–∞–≤–∏—Ç!",
            "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π Telegram ‚Äì –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–º–µ—Ä—Ç–Ω—ã—Ö!",
            "–Ø –≤–µ—Ä—é –≤ —á—É–¥–æ‚Ä¶ –∏ –≤ –ø–æ–¥–∞—Ä–æ–∫ –æ—Ç Telegram!",
            "–•–æ—á—É –ø—Ä–µ–º–∏—É–º, –Ω–æ –∫–æ—à–µ–ª—ë–∫ –ø—Ä–æ—Ç–∏–≤!",
            "–ò–ò –ø—Ä–µ–¥—Å–∫–∞–∑–∞–ª –º–Ω–µ –ø–æ–¥–ø–∏—Å–∫—É‚Ä¶ –∂–¥—ë–º!",
            "–ü—Ä–µ–º–∏—É–º ‚Äì —ç—Ç–æ –∑–æ–ª–æ—Ç–æ –≤ –º–∏—Ä–µ Telegram!",
            "–ï—Å–ª–∏ –∫—É–ø–ª—é –ø—Ä–µ–º–∏—É–º, —Å—Ç–∞–Ω—É —É–º–Ω–µ–µ?",
            "–ö–æ–≥–¥–∞ —É –º–µ–Ω—è –±—É–¥–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∞, –∂–∏–∑–Ω—å –∑–∞–∏–≥—Ä–∞–µ—Ç –∫—Ä–∞—Å–∫–∞–º–∏!",
            "–° –ø—Ä–µ–º–∏—É–º–æ–º –¥–∞–∂–µ –±–æ—Ç—ã –Ω–∞—á–∏–Ω–∞—é—Ç —É–≤–∞–∂–∞—Ç—å!",
            "–î—É—Ä–æ–≤, —Å–¥–µ–ª–∞–π –≤–∏–¥, —á—Ç–æ —è –æ—Å–æ–±–µ–Ω–Ω—ã–π!",
            "–ö–∞–∂–¥—É—é –Ω–æ—á—å –º–µ—á—Ç–∞—é –æ Telegram Premium!",
            "–ë–µ–∑ –∑–≤—ë–∑–¥ —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –Ω–∏—á—Ç–æ–∂–µ—Å—Ç–≤–æ–º!",
            "–ü—Ä–µ–º–∏—É–º ‚Äì —ç—Ç–æ –∫–∞–∫ —Å–ø–æ—Ä—Ç–∑–∞–ª: –≤—Å–µ —Ö–æ—Ç—è—Ç, –Ω–æ –Ω–µ –≤—Å–µ –±–µ—Ä—É—Ç!",
            "–ò–ò —Å–∫–∞–∑–∞–ª, —á—Ç–æ —è —Å–ª–∏—à–∫–æ–º –æ–±—ã—á–Ω—ã–π‚Ä¶",
            "–Ø –ø—Ä–µ–º–∏—É–º –≤ –¥—É—à–µ!",
            "–ö–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –î—É—Ä–æ–≤ –º–µ–Ω—è –∑–∞–º–µ—Ç–∏—Ç!",
            "–ë–µ–∑ –ø—Ä–µ–º–∏—É–º–∞ –∂–∏–∑–Ω—å –∫–∞–∂–µ—Ç—Å—è —Å–µ—Ä–æ–π!",
            "Telegram –±–µ–∑ –ø—Ä–µ–º–∏—É–º–∞ ‚Äì –∫–∞–∫ –∫–æ—Ñ–µ –±–µ–∑ –∫–æ—Ñ–µ–∏–Ω–∞!",
            "–ó–∞–≤—Ç—Ä–∞ —Ç–æ—á–Ω–æ –∫—É–ø–ª—é –ø—Ä–µ–º–∏—É–º‚Ä¶ –º–æ–∂–µ—Ç –±—ã—Ç—å!",
            "–ú–æ—è —Ü–µ–ª—å ‚Äì —Å—Ç–∞—Ç—å —ç–ª–∏—Ç–æ–π Telegram!",
            "–ó–∞—á–µ–º –º–Ω–µ –º–∞—à–∏–Ω–∞, –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–º–∏—É–º?",
            "–ï—Å–ª–∏ –∫—É–ø–ª—é –ø–æ–¥–ø–∏—Å–∫—É, —Å—Ç–∞–Ω—É –±–æ–≥–∞—á–µ?",
            "–ò–Ω–æ–≥–¥–∞ –º–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ Telegram –∏–∑–¥–µ–≤–∞–µ—Ç—Å—è!",
            "–î—É—Ä–æ–≤, —Å–¥–µ–ª–∞–π —Å–∫–∏–¥–∫—É, —è —Ö–æ—Ä–æ—à–∏–π!",
            "–•–æ—á—É –ø—Ä–µ–º–∏—É–º, –Ω–æ –∂–∞–±–∞ –¥—É—à–∏—Ç!",
            "–ö–æ–≥–¥–∞-–Ω–∏–±—É–¥—å —è –ø–æ–ª—É—á—É —ç—Ç–æ—Ç –∑–Ω–∞—á–æ–∫!",
            "–ö—É–ø–ª—é –ø–æ–¥–ø–∏—Å–∫—É –∏ –±—É–¥—É —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –≤—Å–µ—Ö —Å–≤—ã—Å–æ–∫–∞!"
        ];

        // –î–æ–±–∞–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º—É –ø–æ–≥–æ–¥—ã
        this.weather = {
            current: 'clear',
            particles: [],
            nextChangeTime: Date.now() + this.getRandomInterval(20000, 40000), // –°–ª–µ–¥—É—é—â–∞—è —Å–º–µ–Ω–∞ –ø–æ–≥–æ–¥—ã —á–µ—Ä–µ–∑ 20-40 —Å–µ–∫—É–Ω–¥
            possibleTypes: ['clear', 'rain', 'snow', 'wind']
        };

        // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —á–∞—Å—Ç–∏—Ü
        this.maxParticles = 100;
        this.windForce = 0;
        this.windAngle = 0;

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
        console.log('–ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏...');
        this.animate = this.animate.bind(this);
        requestAnimationFrame(this.animate);

        // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Å—Å–∏–≤ –∑–≤–µ–∑–¥ –∏ –∫–æ—Ä–æ–±–∫—É
        this.stars = [];
        this.starBox = {
            x: 50,
            y: this.canvas ? this.canvas.height - 100 : 500,
            width: 80,
            height: 80,
            collectedStars: 0
        };
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∑–≤–µ–∑–¥
        this.lastStarSpawnTime = 0;
        this.starSpawnInterval = 5000; // –ö–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥

        // –°–æ–∑–¥–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–≤–µ–∑–¥—ã (—Ç—Ä–µ—Ç—å –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–∫–µ–º–æ–Ω–æ–≤)
        this.maxStars = Math.floor(30 / 3); // 30 - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫–µ–º–æ–Ω–æ–≤
        for (let i = 0; i < this.maxStars; i++) {
            this.createStar();
        }

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥
        this.starBox.collectedStars = initialStars;

        // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∏–∫–æ–Ω–∫–∏ –ø–æ–≥–æ–¥—ã
        this.weatherIcon = {
            x: 60,  // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –≤ –ª–µ–≤—ã–π –∫—Ä–∞–π
            y: 60,  // –û—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É
            size: 80  // –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä
        };
    }

    generateSimpleBiomes() {
        // –°–æ–∑–¥–∞–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—É—é –∫–∞—Ä—Ç—É –±–∏–æ–º–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const beachY = this.canvas.height * 0.3; // –ü—Ä–∏–º–µ—Ä–Ω–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ –ø–ª—è–∂–∞
        
        for (let y = 0; y < this.canvas.height; y += this.biomeSize) {
            for (let x = 0; x < this.canvas.width; x += this.biomeSize) {
                let biomeType;
                if (y < beachY) {
                    biomeType = 'forest'; // –ó–æ–Ω–∞ —Å –ø–∞–ª—å–º–∞–º–∏
                } else {
                    biomeType = 'sand'; // –ü–ª—è–∂–Ω–∞—è –∑–æ–Ω–∞
                }
                
                const biome = {
                    x: x,
                    y: y,
                    width: this.biomeSize,
                    height: this.biomeSize,
                    name: biomeType
                };
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –∏ –≥—Ä–∞–Ω–∏—Ü—É –¥–ª—è –±–∏–æ–º–∞ (—Ç–µ–ø–µ—Ä—å –æ–Ω–∏ –±—É–¥—É—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º–∏)
                switch(biome.name) {
                    case 'forest':
                        biome.color = 'rgba(46, 139, 87, 0)';
                        biome.borderColor = 'rgba(27, 77, 46, 0)';
                        break;
                    case 'sand':
                        biome.color = 'rgba(222, 184, 135, 0)';
                        biome.borderColor = 'rgba(184, 134, 11, 0)';
                        break;
                }
                
                this.biomes.push(biome);
            }
        }
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–æ–¥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–æ–¥—ã
    isWater(x, y) {
        if (!this.mapLoaded || x < 0 || x >= this.canvas.width || y < 0 || y >= this.canvas.height) {
            return false;
        }
        
        // –ï—Å–ª–∏ —Ç–æ—á–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤—ã—à–µ –ø–∞–ª—å–º (–ø—Ä–∏–º–µ—Ä–Ω–æ 30% –≤—ã—Å–æ—Ç—ã –∫–∞—Ä—Ç—ã), —ç—Ç–æ –≤–æ–¥–∞
        return y < this.canvas.height * 0.3;
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—É—à–∏
    isLand(x, y) {
        if (!this.mapLoaded || x < 0 || x >= this.canvas.width || y < 0 || y >= this.canvas.height) {
            return false;
        }

        // –í—Å—ë, —á—Ç–æ –Ω–µ –≤–æ–¥–∞ - —ç—Ç–æ —Å—É—à–∞
        return y >= this.canvas.height * 0.3;
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–æ–¥ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –º–µ—Å—Ç–Ω–æ—Å—Ç–∏
    getTerrainType(x, y) {
        if (x < 0 || x >= this.canvas.width || y < 0 || y >= this.canvas.height) {
            return this.terrainTypes.OUT_OF_BOUNDS;
        }

        // –î–ª—è –ª–µ—Ç–∞—é—â–∏—Ö –ø–æ–∫–µ–º–æ–Ω–æ–≤ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—É—é –º–µ—Å—Ç–Ω–æ—Å—Ç—å
        if (this.pokemons.some(p => p.x === x && p.y === y && p.isFlying)) {
            return this.terrainTypes.LAND;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø –º–µ—Å—Ç–Ω–æ—Å—Ç–∏
        if (this.isWater(x, y)) {
            return this.terrainTypes.WATER;
        }
        
        return this.terrainTypes.LAND;
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∫–µ–º–æ–Ω–æ–≤
    createPokemon() {
        console.log('–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∫–µ–º–æ–Ω–æ–≤...');
        let attempts = 0;
        const maxAttempts = 1000;
        const usedPokemon = new Set();
        const shuffledPokemon = [...this.allPokemon].sort(() => Math.random() - 0.5);
        
        for (let i = 0; i < 30; i++) {
            let x, y, species;
            let validPosition = false;
            attempts = 0;

            while (!validPosition && attempts < maxAttempts) {
                x = Math.random() * this.canvas.width;
                y = Math.random() * this.canvas.height;
                
                const terrainType = this.getTerrainType(x, y);
                const availablePokemon = shuffledPokemon.filter(p => !usedPokemon.has(p));
                
                if (availablePokemon.length === 0) break;

                // –í—ã–±–∏—Ä–∞–µ–º –ø–æ–∫–µ–º–æ–Ω–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–µ—Å—Ç–Ω–æ—Å—Ç–∏
                if (terrainType === this.terrainTypes.WATER) {
                    species = availablePokemon.find(p => 
                        this.waterTypes.includes(p) || this.flyingTypes.includes(p)
                    );
                } else if (terrainType === this.terrainTypes.LAND) {
                    species = availablePokemon.find(p => 
                        !this.waterTypes.includes(p) || this.flyingTypes.includes(p)
                    );
                }

                // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –ø–æ–∫–µ–º–æ–Ω–∞, –ø—Ä–æ–±—É–µ–º –≤–∑—è—Ç—å –ª–µ—Ç–∞—é—â–µ–≥–æ
                if (!species && this.flyingTypes.some(p => availablePokemon.includes(p))) {
                    species = availablePokemon.find(p => this.flyingTypes.includes(p));
                }

                // –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ—Ç –ø–æ–∫–µ–º–æ–Ω–∞, –±–µ—Ä–µ–º –ª—é–±–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ
                if (!species) {
                    species = availablePokemon[0];
                }
                
                if (species) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–∑–∏—Ü–∏—è –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–∏–ø–∞ –ø–æ–∫–µ–º–æ–Ω–∞
                    const isFlying = this.flyingTypes.includes(species);
                    const isWater = this.waterTypes.includes(species);
                    
                    if (isFlying || 
                        (isWater && terrainType === this.terrainTypes.WATER) ||
                        (!isWater && terrainType === this.terrainTypes.LAND)) {
                        usedPokemon.add(species);
                        validPosition = true;
                    }
                }
                
                attempts++;
            }

            if (attempts >= maxAttempts || !species) {
                console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â—É—é –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –ø–æ–∫–µ–º–æ–Ω–∞ ${i + 1}`);
                continue;
            }

            console.log(`–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∫–µ–º–æ–Ω–∞ ${i + 1}: ${species} –≤ –ø–æ–∑–∏—Ü–∏–∏ (${Math.floor(x)}, ${Math.floor(y)})`);
            const pokemon = new Pokemon(x, y, species);
            pokemon.isFlying = this.flyingTypes.includes(species);
            pokemon.isWater = this.waterTypes.includes(species);
            this.pokemons.push(pokemon);
            this.loadingCount++;
        }
    }

    animate() {
        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
        this.animationFrame++;
        
        // –û—á–∏—â–∞–µ–º canvas
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

        // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∫–∞—Ä—Ç—É –∫–∞–∫ —Ñ–æ–Ω
        if (this.mapLoaded) {
            this.ctx.drawImage(this.mapImage, 0, 0);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±—É—Ñ–µ—Ä–Ω—ã–π canvas, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            if (this.bufferCtx.canvas.width !== this.canvas.width || 
                this.bufferCtx.canvas.height !== this.canvas.height) {
                this.bufferCanvas.width = this.canvas.width;
                this.bufferCanvas.height = this.canvas.height;
                this.bufferCtx.drawImage(this.mapImage, 0, 0);
            }

            // –û—Ç–º–µ—á–∞–µ–º –¥–µ—Ä–µ–≤—å—è (—Ç–µ–ø–µ—Ä—å –Ω–µ–≤–∏–¥–∏–º—ã–µ, –Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ)
            this.ctx.save();
            this.ctx.fillStyle = 'rgba(255, 0, 0, 0)'; // –î–µ–ª–∞–µ–º –∑–∞–ª–∏–≤–∫—É –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π
            this.ctx.strokeStyle = 'rgba(255, 0, 0, 0)'; // –î–µ–ª–∞–µ–º –æ–±–≤–æ–¥–∫—É –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π
            this.trees.forEach(tree => {
                this.ctx.beginPath();
                this.ctx.moveTo(tree.x, tree.y - tree.height);
                this.ctx.lineTo(tree.x - tree.radius, tree.y + tree.radius);
                this.ctx.lineTo(tree.x + tree.radius, tree.y + tree.radius);
                this.ctx.closePath();
                this.ctx.fill();
                this.ctx.stroke();
            });
            this.ctx.restore();
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –±–∏–æ–º–æ–≤ (—Ç–µ–ø–µ—Ä—å –æ–Ω–∏ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—Ä—Ç—É)
        this.biomes.forEach(biome => {
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            switch(biome.name) {
                case 'forest':
                    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é –ª–∏—Å—Ç—å–µ–≤ –ø–∞–ª—å–º
                    break;
                case 'sand':
                    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª—ë–≥–∫—É—é –∞–Ω–∏–º–∞—Ü–∏—é –ø–µ—Å–∫–∞
                    this.drawSandTexture(biome);
                    break;
            }
        });

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ª—É–Ω–Ω—ã—Ö –∫–∞–º–Ω–µ–π
        this.moonStones.forEach(stone => {
            if (!stone.collected) {
                this.ctx.fillStyle = '#8888ff';
                this.ctx.beginPath();
                this.ctx.arc(stone.x, stone.y, 8, 0, Math.PI * 2);
                this.ctx.fill();
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–≤–µ—á–µ–Ω–∏–µ
                const gradient = this.ctx.createRadialGradient(
                    stone.x, stone.y, 0,
                    stone.x, stone.y, 20
                );
                gradient.addColorStop(0, 'rgba(136, 136, 255, 0.3)');
                gradient.addColorStop(1, 'rgba(136, 136, 255, 0)');
                this.ctx.fillStyle = gradient;
                this.ctx.beginPath();
                this.ctx.arc(stone.x, stone.y, 20, 0, Math.PI * 2);
                this.ctx.fill();
            }
        });

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è –ø–æ–∫–µ–º–æ–Ω–æ–≤ –∏ —Å–æ–∑–¥–∞–µ–º –¥—Ä–∞–∫–∏
        this.pokemons.forEach((pokemon1, index1) => {
            this.pokemons.forEach((pokemon2, index2) => {
                if (index1 < index2) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é –ø–∞—Ä—É —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
                    const dx = pokemon1.x - pokemon2.x;
                    const dy = pokemon1.y - pokemon2.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    // –ï—Å–ª–∏ –ø–æ–∫–µ–º–æ–Ω—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–ª–∏–∑–∫–æ –∏ –Ω–µ –¥–µ—Ä—É—Ç—Å—è
                    if (distance < pokemon1.size && 
                        !this.fightingPokemons.some(fight => 
                            fight.pokemon1 === pokemon1 || 
                            fight.pokemon1 === pokemon2 || 
                            fight.pokemon2 === pokemon1 || 
                            fight.pokemon2 === pokemon2
                        ) &&
                        Date.now() - this.lastFightTime >= 30000) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—Ä–æ—à–ª–æ –ª–∏ 30 —Å–µ–∫—É–Ω–¥ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –¥—Ä–∞–∫–∏
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –¥—Ä–∞–∫–∏
                        this.lastFightTime = Date.now();
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—É—é –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å (40%) –¥–ª—è –≤—ã–∫—Ä–∏–∫–æ–≤ –≤–æ –≤—Ä–µ–º—è –¥—Ä–∞–∫–∏
                        const shouldYell = Math.random() < 0.4;
                        
                        // –°–ª—É—á–∞–π–Ω–æ –≤—ã–±–∏—Ä–∞–µ–º, –∫–∞–∫–æ–π –ø–æ–∫–µ–º–æ–Ω –±—É–¥–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å
                        const speakingPokemon = Math.random() < 0.5 ? pokemon1 : pokemon2;
                        
                        // –ü–æ–ª—É—á–∞–µ–º –∏–º–µ–Ω–∞ –ø–æ–∫–µ–º–æ–Ω–æ–≤ –±–µ–∑ —ç–º–æ–¥–∑–∏
                        const pokemon1Name = pokemon1.species.split(' ')[0];
                        const pokemon2Name = pokemon2.species.split(' ')[0];
                        
                        // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω—é—é —Ç–æ—á–∫—É –º–µ–∂–¥—É –ø–æ–∫–µ–º–æ–Ω–∞–º–∏
                        const centerX = (pokemon1.x + pokemon2.x) / 2;
                        const centerY = (pokemon1.y + pokemon2.y) / 2;
                        
                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∫–µ–º–æ–Ω–æ–≤ –±–ª–∏–∑–∫–æ –¥—Ä—É–≥ –∫ –¥—Ä—É–≥—É
                        const fightDistance = pokemon1.size * 0.3; // –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –ø–æ–∫–µ–º–æ–Ω–∞–º–∏
                        const angle = Math.atan2(pokemon2.y - pokemon1.y, pokemon2.x - pokemon1.x);
                        
                        this.fightingPokemons.push({
                            pokemon1: pokemon1,
                            pokemon2: pokemon2,
                            startTime: Date.now(),
                            shouldYell: shouldYell,
                            speakingPokemon: speakingPokemon,
                            lastYellTime: 0,
                            originalPositions: {
                                x1: pokemon1.x,
                                y1: pokemon1.y,
                                x2: pokemon2.x,
                                y2: pokemon2.y
                            },
                            fightPositions: {
                                x1: centerX - Math.cos(angle) * fightDistance / 2,
                                y1: centerY - Math.sin(angle) * fightDistance / 2,
                                x2: centerX + Math.cos(angle) * fightDistance / 2,
                                y2: centerY + Math.sin(angle) * fightDistance / 2
                            }
                        });

                        // –°–æ–∑–¥–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∏—Å–∫—Ä—ã —Å —Ä–∞–∑–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏
                        for (let i = 0; i < 10; i++) {
                            const color = this.sparkColors[Math.floor(Math.random() * this.sparkColors.length)];
                            this.sparkParticles.push({
                                x: (pokemon1.x + pokemon2.x) / 2,
                                y: (pokemon1.y + pokemon2.y) / 2,
                                vx: (Math.random() - 0.5) * 5,
                                vy: (Math.random() - 0.5) * 5,
                                life: 1.0,
                                color: color
                            });
                        }
                    }
                }
            });
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –¥—Ä–∞–∫–∏
        this.fightingPokemons = this.fightingPokemons.filter(fight => {
            const elapsed = Date.now() - fight.startTime;
            
            if (elapsed < 3000) { // –î—Ä–∞–∫–∞ –¥–ª–∏—Ç—Å—è 3 —Å–µ–∫—É–Ω–¥—ã
                // –ï—Å–ª–∏ –ø–æ–∫–µ–º–æ–Ω—ã –¥–æ–ª–∂–Ω—ã –∫—Ä–∏—á–∞—Ç—å –∏ –ø—Ä–æ—à–ª–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫—Ä–∏–∫–∞
                if (fight.shouldYell && Date.now() - fight.lastYellTime > 1000) {
                    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Ñ—Ä–∞–∑—É
                    const randomQuote = this.pokemonBattleQuotes[
                        Math.floor(Math.random() * this.pokemonBattleQuotes.length)
                    ];
                    
                    // –°–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–∫–µ–º–æ–Ω–∞
                    this.currentMessage = {
                        pokemon: fight.speakingPokemon,
                        text: randomQuote,
                        timeLeft: 1000
                    };
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
                    setTimeout(() => {
                        if (this.currentMessage && this.currentMessage.pokemon === fight.speakingPokemon) {
                            this.currentMessage = null;
                        }
                    }, 1000);
                    
                    fight.lastYellTime = Date.now();
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –¥—ë—Ä–≥–∞–Ω—å–µ –≤–æ–∫—Ä—É–≥ –ø–æ–∑–∏—Ü–∏–∏ –¥—Ä–∞–∫–∏
                const shake = Math.sin(elapsed * 0.1) * 3;
                fight.pokemon1.x = fight.fightPositions.x1 + shake;
                fight.pokemon2.x = fight.fightPositions.x2 - shake;
                
                // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –ø–æ–∫–µ–º–æ–Ω–æ–≤ –≤–æ –≤—Ä–µ–º—è –¥—Ä–∞–∫–∏
                fight.pokemon1.isInFight = true;
                fight.pokemon2.isInFight = true;

                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –∏—Å–∫—Ä—ã
                if (Math.random() < 0.3) {
                    const color = this.sparkColors[Math.floor(Math.random() * this.sparkColors.length)];
                    this.sparkParticles.push({
                        x: (fight.pokemon1.x + fight.pokemon2.x) / 2,
                        y: (fight.pokemon1.y + fight.pokemon2.y) / 2,
                        vx: (Math.random() - 0.5) * 5,
                        vy: (Math.random() - 0.5) * 5,
                        life: 1.0,
                        color: color
                    });
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É –∫–æ–≥–æ-—Ç–æ –∏–∑ –¥–µ—Ä—É—â–∏—Ö—Å—è –∑–≤–µ–∑–¥–∞
                this.stars.forEach(star => {
                    if (star.carriedBy === fight.pokemon1 || star.carriedBy === fight.pokemon2) {
                        // 30% —à–∞–Ω—Å –æ—Ç–æ–±—Ä–∞—Ç—å –∑–≤–µ–∑–¥—É
                        if (Math.random() < 0.3) {
                            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫—Ç–æ –Ω–µ—Å–µ—Ç –∑–≤–µ–∑–¥—É –∏ –∫—Ç–æ –º–æ–∂–µ—Ç –µ—ë –æ—Ç–æ–±—Ä–∞—Ç—å
                            const currentCarrier = star.carriedBy;
                            const newCarrier = currentCarrier === fight.pokemon1 ? fight.pokemon2 : fight.pokemon1;
                            
                            // –ú–µ–Ω—è–µ–º –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∑–≤–µ–∑–¥—ã
                            star.carriedBy = newCarrier;
                        }
                    }
                });
                
                return true;
            } else {
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–∫–µ–º–æ–Ω–æ–≤ –Ω–∞ –∏—Ö –∏—Å—Ö–æ–¥–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
                fight.pokemon1.x = fight.originalPositions.x1;
                fight.pokemon1.y = fight.originalPositions.y1;
                fight.pokemon2.x = fight.originalPositions.x2;
                fight.pokemon2.y = fight.originalPositions.y2;
                
                // –†–∞–∑—Ä–µ—à–∞–µ–º –ø–æ–∫–µ–º–æ–Ω–∞–º —Å–Ω–æ–≤–∞ –¥–≤–∏–≥–∞—Ç—å—Å—è
                fight.pokemon1.isInFight = false;
                fight.pokemon2.isInFight = false;
                return false;
            }
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏ –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏—Å–∫—Ä—ã
        this.sparkParticles = this.sparkParticles.filter(spark => {
            spark.x += spark.vx;
            spark.y += spark.vy;
            spark.life -= 0.05;

            if (spark.life > 0) {
                this.ctx.beginPath();
                this.ctx.fillStyle = `${spark.color}, ${spark.life})`;
                this.ctx.arc(spark.x, spark.y, 2, 0, Math.PI * 2);
                this.ctx.fill();
                return true;
            }
            return false;
        });

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–æ–∫–µ–º–æ–Ω–æ–≤
        this.pokemons.forEach(pokemon => {
            pokemon.update(this.pokemons, this.moonStones, this.biomes);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –ø–æ–∫–µ–º–æ–Ω –ø–æ–¥ –¥–µ—Ä–µ–≤–æ–º
            let isUnderTree = false;
            for (const tree of this.trees) {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è —Ç–æ—á–∫–∏ –≤ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫
                const px = pokemon.x;
                const py = pokemon.y;
                
                // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–µ—Ä—à–∏–Ω —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞
                const x1 = tree.x; // –í–µ—Ä—à–∏–Ω–∞
                const y1 = tree.y - tree.radius;
                const x2 = tree.x - tree.radius; // –õ–µ–≤—ã–π –Ω–∏–∂–Ω–∏–π —É–≥–æ–ª
                const y2 = tree.y + tree.radius;
                const x3 = tree.x + tree.radius; // –ü—Ä–∞–≤—ã–π –Ω–∏–∂–Ω–∏–π —É–≥–æ–ª
                const y3 = tree.y + tree.radius;
                
                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–Ω–∞–∫–∞
                const sign = (x1, y1, x2, y2, x3, y3) => {
                    return (x1 - x3) * (y2 - y3) - (x2 - x3) * (y1 - y3);
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —Ç–æ—á–∫–∞ –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞
                const d1 = sign(px, py, x1, y1, x2, y2);
                const d2 = sign(px, py, x2, y2, x3, y3);
                const d3 = sign(px, py, x3, y3, x1, y1);
                
                const hasNeg = (d1 < 0) || (d2 < 0) || (d3 < 0);
                const hasPos = (d1 > 0) || (d2 > 0) || (d3 > 0);
                
                isUnderTree = !(hasNeg && hasPos);
                
                if (isUnderTree) break;
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø—Ä–∞–π—Ç–∞ —Å —É—á–µ—Ç–æ–º –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
            if (pokemon.spriteLoaded) {
                this.ctx.save();
                if (isUnderTree) {
                    this.ctx.globalAlpha = 0.5; // –î–µ–ª–∞–µ–º –ø–æ–∫–µ–º–æ–Ω–∞ –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º –ø–æ–¥ –¥–µ—Ä–µ–≤–æ–º
                }
                this.ctx.drawImage(
                    pokemon.sprite,
                    pokemon.x - pokemon.size/2,
                    pokemon.y - pokemon.size/2,
                    pokemon.size,
                    pokemon.size
                );
                this.ctx.restore();
            }
        });

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ —Å–ø—Ä–∞–π—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã
        if (this.loadingCount > 0) {
            this.loadingCount = this.pokemons.filter(p => !p.spriteLoaded).length;
            if (this.loadingCount === 0) {
                const loadingElement = document.getElementById('loading');
                if (loadingElement) {
                    loadingElement.style.display = 'none';
                }
            }
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ "AI Pokemons" –ø–µ—Ä–µ–¥ –æ—Ç—Ä–∏—Å–æ–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–∫–µ–º–æ–Ω–æ–≤
        this.ctx.save();
        this.ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
        this.ctx.shadowBlur = 10;
        this.ctx.shadowOffsetX = 2;
        this.ctx.shadowOffsetY = 2;
        
        this.ctx.fillStyle = '#FFD700'; // –ó–æ–ª–æ—Ç–æ–π —Ü–≤–µ—Ç
        this.ctx.font = 'bold 36px "Press Start 2P"';
        this.ctx.textAlign = 'center';
        this.ctx.textBaseline = 'middle';
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±–≤–æ–¥–∫—É —Ç–µ–∫—Å—Ç–∞
        this.ctx.strokeStyle = '#000000';
        this.ctx.lineWidth = 3;
        this.ctx.strokeText('AI Pokemons', this.canvas.width / 2, 40);
        
        // –†–∏—Å—É–µ–º —Å–∞–º —Ç–µ–∫—Å—Ç
        this.ctx.fillText('AI Pokemons', this.canvas.width / 2, 40);
        
        this.ctx.restore();

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–∫–µ–º–æ–Ω–∞
        if (this.currentMessage) {
            const pokemon = this.currentMessage.pokemon;
            const text = this.currentMessage.text;
            
            // –†–∏—Å—É–µ–º –æ–±–ª–∞–∫–æ —Å–æ–æ–±—â–µ–Ω–∏—è
            this.ctx.save();
            this.ctx.fillStyle = 'white';
            this.ctx.strokeStyle = 'rgba(0, 0, 0, 0.5)';
            this.ctx.lineWidth = 2;
            
            // –ò–∑–º–µ—Ä—è–µ–º —Ç–µ–∫—Å—Ç —Å –æ–±—ã—á–Ω—ã–º –∂–∏—Ä–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º
            this.ctx.font = 'bold 14px Arial';
            const metrics = this.ctx.measureText(text);
            const padding = 8;
            const bubbleWidth = metrics.width + padding * 2;
            const bubbleHeight = 25;
            
            // –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –±–µ–∑ —Ç—Ä—è—Å–∫–∏
            let textX = pokemon.x;
            let textY = pokemon.y;
            
            // –ï—Å–ª–∏ –ø–æ–∫–µ–º–æ–Ω –≤ –¥—Ä–∞–∫–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –ø–æ–∑–∏—Ü–∏—é –¥–æ —Ç—Ä—è—Å–∫–∏
            const fight = this.fightingPokemons.find(f => 
                f.pokemon1 === pokemon || f.pokemon2 === pokemon
            );
            
            if (fight) {
                if (fight.pokemon1 === pokemon) {
                    textX = fight.fightPositions.x1;
                    textY = fight.fightPositions.y1;
                } else {
                    textX = fight.fightPositions.x2;
                    textY = fight.fightPositions.y2;
                }
            }
            
            // –†–∏—Å—É–µ–º –æ–±–ª–∞–∫–æ —Å –∑–∞–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–º–∏ —É–≥–ª–∞–º–∏
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –ø–æ–∑–∏—Ü–∏—é –æ–±–ª–∞–∫–∞, —á—Ç–æ–±—ã –æ–Ω–æ –Ω–µ –≤—ã—Ö–æ–¥–∏–ª–æ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã
            let bubbleX = textX - bubbleWidth/2;
            let bubbleY = textY - 40; // –ü–æ–¥–Ω–∏–º–∞–µ–º –æ–±–ª–∞–∫–æ –Ω–∞–¥ –ø–æ–∫–µ–º–æ–Ω–æ–º
            
            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–æ X
            if (bubbleX < 0) {
                bubbleX = 0;
            } else if (bubbleX + bubbleWidth > this.canvas.width) {
                bubbleX = this.canvas.width - bubbleWidth;
            }
            
            this.ctx.beginPath();
            this.roundRect(
                bubbleX,
                bubbleY,
                bubbleWidth,
                bubbleHeight,
                10
            );
            this.ctx.fill();
            this.ctx.stroke();
            
            // –†–∏—Å—É–µ–º —Ç–µ–∫—Å—Ç —Å —É—á–µ—Ç–æ–º —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
            this.ctx.fillStyle = 'black';
            this.ctx.textAlign = 'center';
            this.ctx.textBaseline = 'middle';
            this.ctx.font = 'bold 14px Arial';
            this.ctx.fillText(
                text,
                bubbleX + bubbleWidth/2,
                bubbleY + bubbleHeight/2
            );
            
            this.ctx.restore();
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –≤ –±–µ–ª–æ–º –æ–∫–Ω–µ
        this.ctx.save();
        
        // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è —Ñ–æ–Ω–∞
        const gradient = this.ctx.createLinearGradient(
            this.canvas.width / 2 - 150, this.canvas.height - 30,
            this.canvas.width / 2 + 150, this.canvas.height - 30
        );
        gradient.addColorStop(0, 'rgba(255, 255, 255, 0.9)');
        gradient.addColorStop(1, 'rgba(255, 255, 255, 0.9)');
        
        // –†–∏—Å—É–µ–º —Ñ–æ–Ω —Å —Ç–µ–Ω—å—é
        this.ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
        this.ctx.shadowBlur = 10;
        this.ctx.shadowOffsetX = 2;
        this.ctx.shadowOffsetY = 2;
        
        // –†–∏—Å—É–µ–º –∑–∞–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫
        this.roundRect(
            this.canvas.width / 2 - 150,
            this.canvas.height - 40,
            300,
            30,
            15
        );
        this.ctx.fillStyle = gradient;
        this.ctx.fill();
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±–≤–æ–¥–∫—É
        this.ctx.strokeStyle = '#FFD700';
        this.ctx.lineWidth = 2;
        this.ctx.stroke();
        
        // –†–∏—Å—É–µ–º –∑–≤–µ–∑–¥–æ—á–∫–∏
        this.ctx.fillStyle = '#FFD700';
        this.ctx.font = 'bold 18px Arial';
        this.ctx.textAlign = 'center';
        this.ctx.textBaseline = 'middle';
        this.ctx.fillText('‚≠ê', this.canvas.width / 2 - 130, this.canvas.height - 25);
        this.ctx.fillText('‚≠ê', this.canvas.width / 2 + 130, this.canvas.height - 25);
        
        // –†–∏—Å—É–µ–º —Ç–µ–∫—Å—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏
        this.ctx.fillStyle = '#000000';
        this.ctx.font = 'normal 12px "Press Start 2P"';
        this.ctx.fillText('–ù–∞–∂–º–∏ –Ω–∞ –ø–æ–∫–µ–º–æ–Ω–∞', this.canvas.width / 2, this.canvas.height - 25);
        
        this.ctx.restore();

        // –°–ø–∞–≤–Ω –Ω–æ–≤—ã—Ö –∑–≤–µ–∑–¥ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Ö –º–µ–Ω—å—à–µ –º–∞–∫—Å–∏–º—É–º–∞)
        if (Date.now() - this.lastStarSpawnTime > this.starSpawnInterval && 
            this.stars.length < this.maxStars) {
            this.createStar();
            this.lastStarSpawnTime = Date.now();
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∑–≤–µ–∑–¥
        this.stars.forEach(star => {
            if (!star.collected) {
                // –†–∏—Å—É–µ–º –∑–≤–µ–∑–¥—É
                this.ctx.save();
                this.ctx.translate(star.x, star.y);
                this.ctx.rotate(star.rotation);
                
                this.ctx.beginPath();
                this.ctx.fillStyle = 'gold';
                
                // –†–∏—Å—É–µ–º –ø—è—Ç–∏–∫–æ–Ω–µ—á–Ω—É—é –∑–≤–µ–∑–¥—É
                for (let i = 0; i < 5; i++) {
                    const angle = (i * 4 * Math.PI) / 5;
                    const x = Math.cos(angle) * star.size;
                    const y = Math.sin(angle) * star.size;
                    if (i === 0) {
                        this.ctx.moveTo(x, y);
                    } else {
                        this.ctx.lineTo(x, y);
                    }
                }
                
                this.ctx.closePath();
                this.ctx.fill();
                this.ctx.restore();

                // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–∞—â–µ–Ω–∏–µ
                star.rotation += 0.02;
            } else if (star.carriedBy) {
                // –ï—Å–ª–∏ –∑–≤–µ–∑–¥–∞ —Å–æ–±—Ä–∞–Ω–∞ –∏ –Ω–µ—Å–µ—Ç—Å—è –ø–æ–∫–µ–º–æ–Ω–æ–º
                const offsetX = star.carriedBy.x + star.carriedBy.size/4;
                const offsetY = star.carriedBy.y - star.carriedBy.size/4;
                
                // –†–∏—Å—É–µ–º –∑–≤–µ–∑–¥—É
                this.ctx.save();
                this.ctx.translate(offsetX, offsetY);
                this.ctx.rotate(star.rotation);
                
                this.ctx.beginPath();
                this.ctx.fillStyle = 'gold';
                this.ctx.shadowColor = 'rgba(255, 215, 0, 0.5)';
                this.ctx.shadowBlur = 10;
                
                // –†–∏—Å—É–µ–º –ø—è—Ç–∏–∫–æ–Ω–µ—á–Ω—É—é –∑–≤–µ–∑–¥—É
                for (let i = 0; i < 5; i++) {
                    const angle = (i * 4 * Math.PI) / 5;
                    const x = Math.cos(angle) * star.size;
                    const y = Math.sin(angle) * star.size;
                    if (i === 0) {
                        this.ctx.moveTo(x, y);
                    } else {
                        this.ctx.lineTo(x, y);
                    }
                }
                
                this.ctx.closePath();
                this.ctx.fill();
                this.ctx.restore();

                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∑–≤–µ–∑–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
                star.x = offsetX;
                star.y = offsetY;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–∞—â–µ–Ω–∏–µ
                star.rotation += 0.05;
            }
        });

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–æ—Ä–æ–±–∫–∏ –¥–ª—è –∑–≤–µ–∑–¥
        this.ctx.save();
        this.ctx.fillStyle = '#8B4513';
        this.ctx.strokeStyle = '#654321';
        this.ctx.lineWidth = 3;
        
        // –†–∏—Å—É–µ–º –∫–æ—Ä–æ–±–∫—É
        this.roundRect(
            this.starBox.x,
            this.starBox.y,
            this.starBox.width,
            this.starBox.height,
            10
        );
        this.ctx.fill();
        this.ctx.stroke();

        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –∑–≤–µ–∑–¥
        this.ctx.fillStyle = 'white';
        this.ctx.font = 'bold 20px Arial';
        this.ctx.textAlign = 'center';
        this.ctx.fillText(
            `‚≠ê ${this.starBox.collectedStars}`,
            this.starBox.x + this.starBox.width/2,
            this.starBox.y + this.starBox.height/2 + 7
        );
        this.ctx.restore();

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–±–æ—Ä –∑–≤–µ–∑–¥ –ø–æ–∫–µ–º–æ–Ω–∞–º–∏
        this.pokemons.forEach(pokemon => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –Ω–µ—Å–æ–±—Ä–∞–Ω–Ω—ã–º–∏ –∑–≤–µ–∑–¥–∞–º–∏
            this.stars.forEach(star => {
                if (!star.collected && !star.carriedBy) {
                    const dx = pokemon.x - star.x;
                    const dy = pokemon.y - star.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance < pokemon.size/2 + star.size/2) {
                        star.collected = true;
                        star.carriedBy = pokemon;
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Ü–∏—Ç–∞—Ç—É –ø—Ä–æ Telegram Premium –ø—Ä–∏ —Å–±–æ—Ä–µ –∑–≤–µ–∑–¥—ã
                        const randomQuote = this.telegramQuotes[
                            Math.floor(Math.random() * this.telegramQuotes.length)
                        ];
                        
                        this.currentMessage = {
                            pokemon: pokemon,
                            text: randomQuote,
                            timeLeft: this.messageDisplayTime
                        };

                        // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
                        if (this.messageTimer) {
                            clearTimeout(this.messageTimer);
                        }

                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
                        this.messageTimer = setTimeout(() => {
                            this.currentMessage = null;
                        }, this.messageDisplayTime);
                    }
                }
            });

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –Ω–µ—Å–µ—Ç –ª–∏ –ø–æ–∫–µ–º–æ–Ω –∑–≤–µ–∑–¥—É –∫ –∫–æ—Ä–æ–±–∫–µ
            this.stars.forEach(star => {
                if (star.carriedBy === pokemon) {
                    const dx = pokemon.x - (this.starBox.x + this.starBox.width/2);
                    const dy = pokemon.y - (this.starBox.y + this.starBox.height/2);
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance < this.starBox.width/2) {
                        // –ó–≤–µ–∑–¥–∞ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ –∫–æ—Ä–æ–±–∫—É
                        this.starBox.collectedStars++;
                        // –£–¥–∞–ª—è–µ–º –∑–≤–µ–∑–¥—É –∏–∑ –º–∞—Å—Å–∏–≤–∞
                        this.stars = this.stars.filter(s => s !== star);
                    }
                }
            });
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã –ø–µ—Ä–µ–¥ –æ—Ç—Ä–∏—Å–æ–≤–∫–æ–π –ø–æ–∫–µ–º–æ–Ω–æ–≤
        this.updateWeather();

        // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Ä–∏—Å–æ–≤–∫—É –∏–∫–æ–Ω–∫–∏ –ø–æ–≥–æ–¥—ã –≤ —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ, –ø–æ—Å–ª–µ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        this.drawWeatherIcon();

        // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Ä–∏—Å–æ–≤–∫—É –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏
        this.drawButtons();

        requestAnimationFrame(this.animate);
    }

    drawSandTexture(biome) {
        // –î–æ–±–∞–≤–ª—è–µ–º –ª—ë–≥–∫—É—é –∞–Ω–∏–º–∞—Ü–∏—é –ø–µ—Å–∫–∞
        this.ctx.strokeStyle = 'rgba(184, 134, 11, 0.1)';
        for (let i = 0; i < 3; i++) {
            this.ctx.beginPath();
            this.ctx.moveTo(biome.x, biome.y + biome.height * 0.5);
            this.ctx.bezierCurveTo(
                biome.x + biome.width * 0.3, 
                biome.y + biome.height * 0.4 + Math.sin(this.animationFrame * 0.02 + i) * 2,
                biome.x + biome.width * 0.7, 
                biome.y + biome.height * 0.6 + Math.sin(this.animationFrame * 0.02 + i) * 2,
                biome.x + biome.width, 
                biome.y + biome.height * 0.5
            );
            this.ctx.stroke();
        }
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–æ–¥ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Å–æ–æ–±—â–µ–Ω–∏–π
    startMessageSystem() {
        const generateInterval = () => Math.floor(Math.random() * 3000) + 7000; // 7-10 —Å–µ–∫—É–Ω–¥
        
        const showRandomMessage = () => {
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–æ–∫–µ–º–æ–Ω–∞
            if (this.pokemons.length > 0) {
                // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ–∫–µ–º–æ–Ω–æ–≤, –∏—Å–∫–ª—é—á–∞—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≥–æ–≤–æ—Ä–∏–≤—à–µ–≥–æ
                const availablePokemons = this.pokemons.filter(p => p !== this.lastMessagePokemon);
                
                if (availablePokemons.length > 0) {
                    const randomPokemon = availablePokemons[Math.floor(Math.random() * availablePokemons.length)];
                    const randomMessage = this.pokemonClickMessages[Math.floor(Math.random() * this.pokemonClickMessages.length)];
                    
                    // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
                    if (this.messageTimer) {
                        clearTimeout(this.messageTimer);
                    }

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    this.currentMessage = {
                        pokemon: randomPokemon,
                        text: randomMessage,
                        timeLeft: this.messageDisplayTime
                    };

                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≥–æ–≤–æ—Ä–∏–≤—à–µ–≥–æ –ø–æ–∫–µ–º–æ–Ω–∞
                    this.lastMessageTime = Date.now();
                    this.lastMessagePokemon = randomPokemon;

                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
                    this.messageTimer = setTimeout(() => {
                        this.currentMessage = null;
                        // –ü–ª–∞–Ω–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                        setTimeout(showRandomMessage, generateInterval());
                    }, this.messageDisplayTime);
                }
            }
        };

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        setTimeout(showRandomMessage, generateInterval());
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è —Å–∫—Ä—É–≥–ª–µ–Ω–Ω—ã—Ö –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤
    roundRect(x, y, width, height, radius) {
        this.ctx.beginPath();
        this.ctx.moveTo(x + radius, y);
        this.ctx.lineTo(x + width - radius, y);
        this.ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
        this.ctx.lineTo(x + width, y + height - radius);
        this.ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
        this.ctx.lineTo(x + radius, y + height);
        this.ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
        this.ctx.lineTo(x, y + radius);
        this.ctx.quadraticCurveTo(x, y, x + radius, y);
        this.ctx.closePath();
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è –∑–≤–µ–∑–¥—ã
    createStar() {
        const star = {
            x: Math.random() * (this.canvas.width - 100) + 50,
            y: Math.random() * (this.canvas.height - 100) + 50,
            size: 8, // –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä –∑–≤–µ–∑–¥—ã (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ–∫–µ–º–æ–Ω–∞ 24)
            rotation: Math.random() * Math.PI * 2,
            collected: false,
            carriedBy: null
        };
        this.stars.push(star);
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
    getRandomInterval(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Å—Ç–∏—Ü—ã –ø–æ–≥–æ–¥—ã
    createWeatherParticle() {
        const particle = {
            x: Math.random() * this.canvas.width,
            y: -10,
            speed: Math.random() * 2 + 3,
            size: 0,
            angle: 0
        };

        switch (this.weather.current) {
            case 'rain':
                particle.size = Math.random() * 2 + 3;
                particle.angle = Math.PI / 3; // –£–≥–æ–ª –ø–∞–¥–µ–Ω–∏—è –¥–æ–∂–¥—è
                particle.color = 'rgba(120, 120, 255, 0.5)';
                break;
            case 'snow':
                particle.size = Math.random() * 3 + 2;
                particle.speed = Math.random() * 1 + 1;
                particle.angle = Math.PI / 2;
                particle.rotation = Math.random() * Math.PI * 2;
                particle.color = 'rgba(255, 255, 255, 0.8)';
                break;
            case 'wind':
                particle.size = Math.random() * 2 + 1;
                particle.x = -10;
                particle.y = Math.random() * this.canvas.height;
                particle.speed = Math.random() * 3 + 2;
                particle.color = 'rgba(200, 200, 200, 0.3)';
                break;
        }

        return particle;
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã
    updateWeather() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ —Å–º–µ–Ω–∏—Ç—å –ø–æ–≥–æ–¥—É
        if (Date.now() > this.weather.nextChangeTime) {
            const newWeather = this.weather.possibleTypes[
                Math.floor(Math.random() * this.weather.possibleTypes.length)
            ];
            this.weather.current = newWeather;
            this.weather.nextChangeTime = Date.now() + this.getRandomInterval(20000, 40000);
            this.weather.particles = []; // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ —á–∞—Å—Ç–∏—Ü—ã

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–µ—Ç—Ä–∞
            if (this.weather.current === 'wind') {
                this.windForce = Math.random() * 2 + 1;
                this.windAngle = Math.random() * Math.PI / 4;
            }
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —á–∞—Å—Ç–∏—Ü—ã
        if (this.weather.current !== 'clear' && 
            this.weather.particles.length < this.maxParticles) {
            this.weather.particles.push(this.createWeatherParticle());
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —á–∞—Å—Ç–∏—Ü—ã
        this.weather.particles = this.weather.particles.filter(particle => {
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —á–∞—Å—Ç–∏—Ü—ã
            switch (this.weather.current) {
                case 'rain':
                    particle.x += Math.cos(particle.angle) * particle.speed;
                    particle.y += Math.sin(particle.angle) * particle.speed;
                    break;
                case 'snow':
                    particle.x += Math.sin(particle.rotation) * 0.5 + Math.cos(this.windAngle) * this.windForce;
                    particle.y += particle.speed;
                    particle.rotation += 0.01;
                    break;
                case 'wind':
                    particle.x += particle.speed + Math.cos(this.windAngle) * this.windForce;
                    particle.y += Math.sin(this.windAngle) * this.windForce;
                    break;
            }

            // –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —á–∞—Å—Ç–∏—Ü—É
            this.ctx.fillStyle = particle.color;
            
            if (this.weather.current === 'snow') {
                // –†–∏—Å—É–µ–º —Å–Ω–µ–∂–∏–Ω–∫—É
                this.ctx.save();
                this.ctx.translate(particle.x, particle.y);
                this.ctx.rotate(particle.rotation);
                
                for (let i = 0; i < 6; i++) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, 0);
                    this.ctx.lineTo(0, particle.size);
                    this.ctx.stroke();
                    this.ctx.rotate(Math.PI / 3);
                }
                
                this.ctx.restore();
            } else {
                // –†–∏—Å—É–µ–º –¥–æ–∂–¥—å –∏–ª–∏ –≤–µ—Ç–µ—Ä
                this.ctx.beginPath();
                this.ctx.arc(particle.x, particle.y, particle.size / 2, 0, Math.PI * 2);
                this.ctx.fill();
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —á–∞—Å—Ç–∏—Ü–∞ –≤—Å–µ –µ—â–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —ç–∫—Ä–∞–Ω–∞
            return !(particle.y > this.canvas.height || 
                    particle.x > this.canvas.width || 
                    particle.x < -20);
        });
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–æ–¥ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∏–∫–æ–Ω–∫–∏ –ø–æ–≥–æ–¥—ã
    drawWeatherIcon() {
        this.ctx.save();
        
        // –°–æ–∑–¥–∞–µ–º —Ñ–æ–Ω –¥–ª—è –∏–∫–æ–Ω–∫–∏
        this.ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
        this.ctx.beginPath();
        this.ctx.arc(this.canvas.width / 2 - 260, 40, 25, 0, Math.PI * 2);
        this.ctx.fill();
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–Ω—å
        this.ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
        this.ctx.shadowBlur = 5;
        this.ctx.shadowOffsetX = 2;
        this.ctx.shadowOffsetY = 2;
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –¥–ª—è —ç–º–æ–¥–∑–∏
        this.ctx.font = 'bold 40px Arial';
        this.ctx.textAlign = 'center';
        this.ctx.textBaseline = 'middle';

        // –í—ã–±–∏—Ä–∞–µ–º —ç–º–æ–¥–∑–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–≥–æ–¥—ã
        let emoji;
        switch (this.weather.current) {
            case 'rain':
                emoji = 'üåßÔ∏è';
                break;
            case 'snow':
                emoji = 'üå®Ô∏è';
                break;
            case 'wind':
                emoji = 'üí®';
                break;
            case 'clear':
                emoji = '‚òÄÔ∏è';
                break;
        }

        // –†–∏—Å—É–µ–º —ç–º–æ–¥–∑–∏
        this.ctx.fillText(emoji, this.canvas.width / 2 - 260, 40);
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–µ–Ω—å
        this.ctx.shadowColor = 'transparent';
        this.ctx.shadowBlur = 0;
        this.ctx.shadowOffsetX = 0;
        this.ctx.shadowOffsetY = 0;
        
        this.ctx.restore();
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ NFT
    isClickOnNFTButton(x, y) {
        const buttonX = this.canvas.width - 160;
        const buttonY = this.canvas.height - 40;
        const buttonWidth = 140;
        const buttonHeight = 30;
        
        return x >= buttonX && x <= buttonX + buttonWidth &&
               y >= buttonY && y <= buttonY + buttonHeight;
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ Telegram
    isClickOnTelegramButton(x, y) {
        const buttonX = 20;
        const buttonY = this.canvas.height - 40;
        const buttonWidth = 140;
        const buttonHeight = 30;
        
        return x >= buttonX && x <= buttonX + buttonWidth &&
               y >= buttonY && y <= buttonY + buttonHeight;
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∫–Ω–æ–ø–æ–∫
    drawButtons() {
        // –†–∏—Å—É–µ–º –∫–Ω–æ–ø–∫—É NFT —Å–ø—Ä–∞–≤–∞ –≤–Ω–∏–∑—É
        this.ctx.save();
        this.ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
        this.ctx.shadowBlur = 3;
        this.ctx.shadowOffsetX = 1;
        this.ctx.shadowOffsetY = 1;
        
        // –§–æ–Ω –∫–Ω–æ–ø–∫–∏
        this.ctx.fillStyle = 'rgba(255, 215, 0, 0.7)';
        this.roundRect(
            this.canvas.width - 160,
            this.canvas.height - 40,
            140,
            30,
            15
        );
        this.ctx.fill();
        
        // –û–±–≤–æ–¥–∫–∞ –∫–Ω–æ–ø–∫–∏
        this.ctx.strokeStyle = 'rgba(0, 0, 0, 0.5)';
        this.ctx.lineWidth = 1;
        this.ctx.stroke();
        
        // –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
        this.ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
        this.ctx.font = 'bold 14px Arial';
        this.ctx.textAlign = 'center';
        this.ctx.textBaseline = 'middle';
        this.ctx.fillText('NFT Collection', this.canvas.width - 90, this.canvas.height - 25);
        
        this.ctx.restore();

        // –†–∏—Å—É–µ–º –∫–Ω–æ–ø–∫—É Telegram —Å–ª–µ–≤–∞ –≤–Ω–∏–∑—É
        this.ctx.save();
        this.ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
        this.ctx.shadowBlur = 3;
        this.ctx.shadowOffsetX = 1;
        this.ctx.shadowOffsetY = 1;
        
        // –§–æ–Ω –∫–Ω–æ–ø–∫–∏
        this.ctx.fillStyle = 'rgba(0, 136, 204, 0.7)';
        this.roundRect(
            20,
            this.canvas.height - 40,
            140,
            30,
            15
        );
        this.ctx.fill();
        
        // –û–±–≤–æ–¥–∫–∞ –∫–Ω–æ–ø–∫–∏
        this.ctx.strokeStyle = 'rgba(0, 0, 0, 0.5)';
        this.ctx.lineWidth = 1;
        this.ctx.stroke();
        
        // –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
        this.ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
        this.ctx.font = 'bold 14px Arial';
        this.ctx.textAlign = 'center';
        this.ctx.textBaseline = 'middle';
        this.ctx.fillText('Telegram Channel', 90, this.canvas.height - 25);
        
        this.ctx.restore();
    }
}

// –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
window.onload = () => {
    console.log('–ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã...');
    window.gameInstance = new Game();
}; 